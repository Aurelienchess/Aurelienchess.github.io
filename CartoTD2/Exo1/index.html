<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Three.js — Exercice 1</title>
<style>
html,body { margin:0; height:100%; overflow:hidden; background:#000; }
canvas { display:block; }
#info { position: absolute; left:10px; top:10px; color:#fff; font-family: sans-serif; z-index:10; }
</style>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.180.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.180.0/examples/jsm/"
  }
}
</script>
</head>
<body>
<div id="info">Exercice 1 — Terre + Cube + Casque + Particules</div>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const scene = new THREE.Scene();
scene.background = new THREE.Color(0x223344);
scene.fog = new THREE.FogExp2(0x111122, 0.03);

const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
camera.position.set(0, 2, 8);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
document.body.appendChild(renderer.domElement);

const ambient = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambient);
const dir = new THREE.DirectionalLight(0xffffff, 1.2);
dir.position.set(5,10,7);
scene.add(dir);

const plane = new THREE.Mesh(
  new THREE.PlaneGeometry(20,20),
  new THREE.MeshStandardMaterial({ color:0x222233 })
);
plane.rotation.x = -Math.PI/2;
plane.position.y = 0;
scene.add(plane);

const texLoader = new THREE.TextureLoader();
const earthTexture = texLoader.load('https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg');
const bumpMap = texLoader.load('https://threejs.org/examples/textures/planets/earth_bump_2048.jpg');
const specMap = texLoader.load('https://threejs.org/examples/textures/planets/earth_specular_2048.jpg');

const sphere = new THREE.Mesh(
  new THREE.SphereGeometry(1,64,64),
  new THREE.MeshPhongMaterial({ map:earthTexture, bumpMap:bumpMap, bumpScale:0.05, specularMap:specMap, specular:new THREE.Color('grey') })
);
sphere.position.set(-2,1,0);
scene.add(sphere);

const cloudsTexture = texLoader.load('https://threejs.org/examples/textures/planets/earth_clouds_1024.png');
const clouds = new THREE.Mesh(
  new THREE.SphereGeometry(1.01,64,64),
  new THREE.MeshLambertMaterial({ map:cloudsTexture, transparent:true })
);
clouds.position.copy(sphere.position);
scene.add(clouds);

const cubeTexture = texLoader.load('https://threejs.org/examples/textures/crate.gif'); // image du motif
const cube = new THREE.Mesh(
  new THREE.BoxGeometry(1,1,1),
  new THREE.MeshStandardMaterial({ map: cubeTexture, roughness:0.5 })
);
cube.position.set(5.5,1,0);
scene.add(cube);


const loader = new GLTFLoader();
loader.load(
  'https://cdn.jsdelivr.net/gh/mrdoob/three.js@r180/examples/models/gltf/DamagedHelmet/glTF/DamagedHelmet.gltf',
  (gltf) => {
    const model = gltf.scene;
    model.scale.set(2,2,2);
    model.position.set(2,1,0);
    scene.add(model);
  },
  undefined,
  (err) => console.error('Erreur GLTF:',err)
);

const particlesGeo = new THREE.BufferGeometry();
const particlesCount = 3000;
const posArray = new Float32Array(particlesCount*3);
for(let i=0;i<particlesCount*3;i++){ posArray[i]=(Math.random()-0.5)*50; }
particlesGeo.setAttribute('position', new THREE.BufferAttribute(posArray,3));
const particlesMat = new THREE.PointsMaterial({ color:0xffffff, size:0.05 });
const particles = new THREE.Points(particlesGeo,particlesMat);
scene.add(particles);

const controls = new OrbitControls(camera,renderer.domElement);
controls.target.set(0,1,0);
controls.update();

if(window.DeviceOrientationEvent){
  window.addEventListener('deviceorientation',(ev)=>{
    if(ev.gamma!==null){
      sphere.rotation.x = THREE.MathUtils.degToRad(ev.beta||0)*0.5;
      sphere.rotation.z = THREE.MathUtils.degToRad(ev.gamma||0)*0.5;
    }
  },true);
}

let angle=0;
function animate(){
  angle+=0.01;
  sphere.rotation.y += 0.002;
  clouds.rotation.y += 0.0025;
  cube.rotation.x += 0.01;
  cube.rotation.y += 0.02;

  controls.update();
  renderer.render(scene,camera);
}
renderer.setAnimationLoop(animate);

window.addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
